<!DOCTYPE html>
<html>
<head>


<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyDB8GQeCMAItWN2H-sop_tv6b61EPI8h5M"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
<script src="https://developer.relayr.io/relayr-browser-sdk.min.js"></script>

<script>

//getRelayrData('b721c76a-3e67-4913-92b2-0f303bd81a15',
//				'Bearer 1dVN.F0UySj_a5kVltaTb3Qg57M-I5wV',map);
function getRelayrData(deviceId,token,map){
	requestURI="https://api.relayr.io/devices/"+deviceId+"/readings";
	$.ajax({
		url:requestURI,
			type:"GET",
			beforeSend:function(xhr){
				xhr.setRequestHeader("Content-Type","application/json");
				xhr.setRequestHeader("Authorization",token)
			},
			success:function(data){
				$(data.readings).each(function(index,element){
					if(element.meaning=="location"){
						latitude=element.value.latitude;
						longitude=element.value.longitude;
						latLong={latitude,longitude};
						initMarker(map,latLong,"bees bees bees");
					}
				});
			}
		}
	);
}


function initialize() {
	var latLongCenter={lat:36.0851696,lng:-115.1829873};
	var map=initMap(latLongCenter);
	getRelayrData('b721c76a-3e67-4913-92b2-0f303bd81a15',
				'Bearer 1dVN.F0UySj_a5kVltaTb3Qg57M-I5wV',map);
	
  
  
  /*
  var marker = new google.maps.Marker({
		  position: latLong,
		  map: map,
		  title: 'Hello World!'
		});
	marker.addListener('click', function() {
		  //map.setZoom(10);
		  //map.setCenter(marker.getPosition());
		  var infowindow=new google.maps.InfoWindow();
		  infowindow.setContent('bees bees bees');
		  infowindow.open(map,marker);
		});
	*/
  
  
}

function initMarker(map,latLong,content){
	var marker = new google.maps.Marker({
		  position: latLong,
		  map: map,
		  title: 'Marker title here'
		});
	marker.addListener('click', function() {
		  var infowindow=new google.maps.InfoWindow();
		  infowindow.setContent(content);
		  infowindow.open(map,marker);
		});
}

function initMap(latLong){
	var mapProp = {
		center:latLong,
		zoom:8,
		mapTypeId:google.maps.MapTypeId.ROADMAP
	};
	var map=new google.maps.Map(document.getElementById("googleMap"),mapProp);
	return map;
}

google.maps.event.addDomListener(window, 'load', initialize);


</script>
</head>

<body>
<div id="googleMap" style="width:500px;height:380px;"></div>
</body>

</html>